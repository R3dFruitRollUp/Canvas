#! /usr/bin/env python

#Proprietary CANVAS source code - use only under the license agreement
#specified in LICENSE.txt in your CANVAS distribution
#Copyright Immunity, Inc, 2002-2008
#http://www.immunityinc.com/CANVAS/ for more information

import sys
if '.' not in sys.path:
    sys.path.append('.')

from exploitutils import *
from canvasexploit import canvasexploit

NAME                    = "drinkcoaster"
DESCRIPTION             = "Provides a useful drink coaster! (drive D: is used)"
VERSION                 = "1.0"

DOCUMENTATION           = {}

PROPERTY                = {}
PROPERTY['TYPE']        = "Commands"
PROPERTY['SITE']        = "Local"

class theexploit(canvasexploit):
    def __init__(self):
        canvasexploit.__init__(self)
        self.result = ""
        self.name   = NAME
        return

    def run(self):
        self.setInfo("%s (in progress)" % (NAME))
        for node in self.argsDict["passednodes"]:            
            type = node.nodetype

            if type == "UnixShellNode":
                self.result = node.runcommand("eject /dev/cdrom")
            elif "linux" in node.capabilities:
                result = node.shell.runcommand("eject /dev/cdrom")
            elif "win32api" in node.capabilities:
                self.result = node.shell.drinkcoaster("D:")
            else:
                self.log("Node of type %s not supported yet." % type)
                pass

            if self.result != "":
                self.log("Result: %s" % self.result)
            
        self.setInfo("%s - (finished)" % (NAME))
        return 1

